<script>
    // Calculate the next dance. This can't be done with Jekyll/Liquid
    // because the html is generated at build time. The calculation
    // needs to happen at run time.
    function getNextDance() {
        today = new Date();
        upcoming_dance_nodes = document.getElementsByClassName('upcoming-dance');
        next_dance_div = document.getElementById('next-dance-div');
        next_dance_node = document.getElementById('next-dance-card');
        for (const dance_node of upcoming_dance_nodes) {
            dance_date = new Date(dance_node.getAttribute('data-date'));
            dance_date = new Date(dance_date.valueOf()+24*60*60*1000); // Was previous midnight, so add one day
            if (dance_date >= today) {
                const new_dance_node = dance_node.cloneNode(true);
                new_dance_node.classList.remove('upcoming-dance');
                new_dance_node.id = 'next-dance';
                next_dance_div.replaceChild(new_dance_node,next_dance_node);
                next_dance_div.style.display = 'initial';
                break;
            }
        }
    }
    document.addEventListener('DOMContentLoaded', getNextDance);
</script>

<img class="banner-img" alt="A blurry photo of dancers" src="{{site.baseurl}}/assets/images/banner_cropped.jpg">

<div id="next-dance-div" style="display: none">
<h2>
{% if page.lang == "en" %}
Our next dance
{% elsif page.lang == "fr" %}
La prochaine danse
{% endif %}
</h2>
<div class="dance-card" id='next-dance-card'>
    <!-- To be filled in with javascript -->
</div>
</div>

<h1>
{% if page.lang == "en" %}
Welcome to ContraMontreal!
{% elsif page.lang == "fr" %}
Bienvenue à ContraMontreal!
{% endif %}
</h1>

{% if page.lang == "en" %}
<ul>
<li><strong>Community-oriented:</strong> Our dances have dancers of all ages, genders, and experience levels, and anyone can dance with anyone!</li>
<li><strong>Live music:</strong> We always dance to live music, by talented local or travelling musicians.</li>
<li><strong>No experience necessary:</strong> Contra dancing is very beginner friendly. All dances are taught just before they are danced. If you can walk you can dance!</li>
</ul>
<p>If you have never been to a contra dance before please read our <a href="{{site.baseurl}}/faq_en">New Dancer FAQ</a>.</p>
{% elsif page.lang == "fr" %}
<p>To be translated</p>
{% endif %}

{% if page.lang == "en" %}
<h3>Schedule</h3>
<p>We dance on most second and fourth Saturdays from September to June.</p>
<p>Our typical schedule is:</p>
<ul>
    <li><strong>6:30pm - 7pm:</strong> Introductory lesson, recommended for new dancers</li>
    <li><strong>7pm - 9:30pm:</strong> Contra dance</li>
</ul>
{% elsif page.lang == "fr" %}
<h3>Calandrier et Horaire</h3>
<p>To be translated</p>
{% endif %}

{% if page.lang == "en" %}
<h3>Location</h3>
<p>Our dances are usually at Patro Villeray, 7355 Avenue Christophe-Colomb, Montreal.</p>
<p>Getting there:</p>
<ul>
    <li><strong>Metro:</strong> The closest metro station is Jean-Talon, on the orange and blue lines, a ten minute walk from the hall.</li>
    <li><strong>Bike:</strong> There are bike lanes on Christophe-Colomb and bike parking in front of the hall. There are BIXI stations nearby as well.</li>
    <li><strong>Car:</strong> Parking is available in the parking lot in front of the building, accessible from Avenue Christoph-Colomb, or the parking lot behind the building, accessible from Rue Everett.</li>
</ul>
<p>Go in the main entrance on Avenue Christophe-Colomb, then go down the hallway to the left to find Room R.01.</p>
<p>Please be advised that there is major construction on Rue Jean-Talon Est, and the intersection with Avenue Christophe-Colomb may be closed to vehicles at times. The area is still passable on foot and bike.</p>
{% elsif page.lang == "fr" %}
<h3>Lieu</h3>
<p>To be translated</p>
{% endif %}

{% if page.lang == "en" %}
<h3>Cost</h3>
<p>We have a sliding scale payment system.</p>
<ul>
    <li>Minimum: $8</li>
    <li>Suggested: $15-20</li>
    <li>Sponsor: $25</li>
    <li>Children: Free</li>
</ul>
<p>We offer this price flexibility to keep our dances accessible while also being able to pay our talented musicians and callers. Cash is preferred, but we also accept Interac eTransfer and PayPal.</p>
{% elsif page.lang == "fr" %}
<h3>Coût</h3>
<p>To be translated</p>
{% endif %}

{% if page.lang == "en" %}
<h3>Safety</h3>
<p>To keep all of our dancers and our community safe, please stay home if you have cold or flu-like symptoms, even if they are minor. Masks are optional at all of our dances.</p>
{% elsif page.lang == "fr" %}
<h3>Santé</h3>
<p>To be translated</p>
{% endif %}

{% if page.lang == "en" %}
<h3>Contact</h3>
<ul>
    <li><a href="{{site.baseurl}}/newsletter">Subscribe to our newsletter</a> to find out about upcoming dances and other news.</li>
    <li>Follow us on Instagram <a href="https://www.instagram.com/contramontreal/">@contramontreal</a></li>
    <li>Follow us on Facebook <a href="https://www.facebook.com/contramontreal">@contramontreal</a></li>
    <li>Join our Facebook group <a href="https://www.facebook.com/groups/223410984511785/">Montreal Contra Dances</a></li>
    <li>Email us at <a href="mailto:info@contramontreal.org">info@contramontreal.org</a></li>
</ul>
{% elsif page.lang == "fr" %}
<h3>Coordonnées</h3>
<p>To be translated</p>
{% endif %}

<h2>
{% if page.lang == "en" %}
Dances this season
{% elsif page.lang == "fr" %}
Danses cette saison
{% endif %}
</h2>

{% for dance in site.data.dances %}
<div class="dance-card upcoming-dance" data-date="{{dance.date}}">
    <div class="dance-special">
        {% if page.lang == "en" %}
        {{dance.special.en}}
        {% elsif page.lang == "fr" %}
        {{dance.special.fr}}
        {% endif %}
    </div>
    <div class="dance-date">
    {% if dance.date and dance.date != "" %}
        {% assign months_index = dance.date | date: "%m" | minus: 1 %}
        {% assign day_index = dance.date | date: "%w" | minus: 0 %}
        {% if page.lang == "en" %}
        {% assign month_text = site.data.data.months.en[months_index] %}
        {% assign day_text = site.data.data.days.en[day_index] %}
        {{ day_text }}, {{month_text}} {{ dance.date | date: "%d" }}, {{ dance.date | date: "%Y" }}
        {% elsif page.lang == "fr" %}
        {% assign month_text = site.data.data.months.fr[months_index] %}
        {% assign day_text = site.data.data.days.fr[day_index] %}
        {{ day_text }} {{ dance.date | date: "%d" }} {{ month_text }} {{ dance.date | date: "%Y" }}
        {% endif %}
    {% endif %}
    </div>
    <div class="dance-time">
        {% if page.lang == "en" %}
        {% if dance.time.en and dance.time.en != "" %}{{dance.time.en}}{% else %}{{site.data.data.default_time.en}}{% endif %}
        {% elsif page.lang == "fr" %}
        {% if dance.time.fr and dance.time.fr != "" %}{{dance.time.fr}}{% else %}{{site.data.data.default_time.fr}}{% endif %}
        {% endif %}
    </div>
    <div class="dance-location">
        {% if page.lang == "en" %}
        {% if dance.location.en and dance.location.en != "" %}{{dance.location.en}}{% else %}{{site.data.data.default_location.en}}{% endif %}
        {% elsif page.lang == "fr" %}
        {% if dance.location.fr and dance.location.fr != "" %}{{dance.location.fr}}{% else %}{{site.data.data.default_location.fr}}{% endif %}
        {% endif %}
    </div>
    <div class="dance-band">
        {% if page.lang == "en" %}
        {% if dance.band.en and dance.band.en != "" %}Band: {{dance.band.en}}{% elsif dance.band and dance.band != "" %}Band: {{dance.band}}{% endif %}
        {% elsif page.lang == "fr" %}
        {% if dance.band.fr and dance.band.fr != "" %}Musique par: {{dance.band.fr}}{% elsif dance.band and dance.band != "" %}Musique par: {{dance.band}}{% endif %}
        {% endif %}
    </div>
    <div class="dance-caller">
        {% if page.lang == "en" %}
        {% if dance.caller.en and dance.caller.en != "" %}Caller: {{dance.caller.en}}{% elsif dance.caller and dance.caller != "" %}Caller: {{dance.caller}}{% endif %}
        {% elsif page.lang == "fr" %}
        {% if dance.caller.fr and dance.caller.fr != "" %}Callé par: {{dance.caller.fr}}{% elsif dance.caller and dance.caller != "" %}Callé par: {{dance.caller}}{% endif %}
        {% endif %}
    </div>
    <div class="dance-text">
        {% if page.lang == "en" %}
        {{dance.text.en}}
        {% elsif page.lang == "fr" %}
        {{dance.text.fr}}
        {% endif %}
    </div>
</div>
{% endfor %}

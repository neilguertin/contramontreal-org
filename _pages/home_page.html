<script>
    // Calculate the next dance. This can't be done with Jekyll/Liquid
    // because the html is generated at build time. The calculation
    // needs to happen at run time.
    // Comparison is done with date objects with local timezone.
    // The time portion of these objects is 0 so only the date is compared
    function getNextDance() {
        today = new Date();
        today.setHours(0,0,0,0);
        upcoming_dance_nodes = document.getElementsByClassName('upcoming-dance');
        next_dance_div = document.getElementById('next-dance-div');
        next_dance_card = document.getElementById('next-dance-card');
        next_dance_node = document.getElementById('next-dance');
        for (const dance_node of upcoming_dance_nodes) {
            // Have to construct the date like this because
            // new Date(dance_node.getAttribute('data-date'))
            // creates it at UTC midnight
            dance_date_str = dance_node.getAttribute('data-date'); // Like 2024-01-01
            dance_date = new Date(dance_date_str.slice(0,4),dance_date_str.slice(5,7)-1,dance_date_str.slice(8,10));
            if (dance_date >= today) {
                const new_dance_node = dance_node.cloneNode(true);
                new_dance_node.classList.remove('upcoming-dance');
                new_dance_node.id = 'next-dance';
                next_dance_card.replaceChild(new_dance_node,next_dance_node);
                next_dance_div.style.display = 'initial';
                break;
            } else {
                // Hide the card
                dance_node.parentElement.classList.add('hide-dance-card');
            }
        }
    }
    document.addEventListener('DOMContentLoaded', getNextDance);
</script>

<img class="banner-img" alt="A blurry photo of dancers" src="/assets/images/banner_cropped.jpg">

<div id="next-dance-div" style="display: none">
    <h2>
    {% if page.lang == "en" %}
        Our next dance
    {% elsif page.lang == "fr" %}
        La prochaine danse
    {% endif %}
    </h2>
    <div class="dance-card" id="next-dance-card">
        <div id="next-dance">
            <!-- To be filled in with javascript -->
        </div>
    </div>
</div>

<h1>
    {% if page.lang == "en" %}
        Welcome to ContraMontreal!
    {% elsif page.lang == "fr" %}
        Bienvenue à ContraMontreal!
    {% endif %}
</h1>

{% if page.lang == "en" %}
    <ul>
        <li><strong>Community-oriented:</strong> Our dances have dancers of all ages, genders, and experience levels, and anyone can dance with anyone!</li>
        <li><strong>Live music:</strong> We always dance to live music, by talented local or travelling musicians.</li>
        <li><strong>No experience necessary:</strong> Contra dancing is very beginner friendly. All dances are taught just before they are danced. If you can walk you can dance!</li>
    </ul>
    <p>If you have never been to a contra dance before please read our <a href="/en/faq">New Dancer FAQ</a>.</p>
{% elsif page.lang == "fr" %}
    <ul>
        <li><strong>Axés sur la communauté :</strong> Nos danses accueillent des danseurs de tous âges, genres et niveaux d'expérience, et tout le monde peut danser avec n'importe qui!</li>
        <li><strong>Musique live :</strong> Nous dansons toujours sur de la musique live, interprétée par de talentueux musiciens locaux ou visiteurs.</li>
        <li><strong>Aucune expérience nécessaire :</strong> La contredanse est très adaptée aux débutants. Toutes les danses sont enseignées juste avant d'être dansées. Si tu peux marcher, tu peux danser!</li>
    </ul>
    <p>Si vous n'avez jamais assisté à une contredanse auparavant, veuillez lire notre <a href="/fr/faq">FAQ pour les débutant(e)s</a>.</p>
{% endif %}

{% if page.lang == "en" %}
    <h3>Schedule</h3>
    <p>We usually dance two weekends a month, alternating Saturday evenings and Sunday afternoons. During the summer we dance about once per month in the afternoon.</p>
    <p>Always check the time and date before coming as our calendar may not be perfectly regular. See our full calendar below.</p>
    <p>Our typical times are:</p>
    <ul>
        <li><strong>2:30pm - 3pm:</strong> Introductory lesson, recommended for new dancers</li>
        <li><strong>3pm - 5:30pm:</strong> Contra dance</li>
    </ul>
    <p>or</p>
    <ul>
        <li><strong>6:30pm - 7pm:</strong> Introductory lesson, recommended for new dancers</li>
        <li><strong>7pm - 9:30pm:</strong> Contra dance</li>
    </ul>
{% elsif page.lang == "fr" %}
    <h3>Calendrier et Horaire</h3>
    <p>Nous dansons en général deux fins de semaine par mois, en alternance le samedi soir et le dimanche après-midi. En été, nous dansons envrion une fois par mois l'après-midi.</p>
    <p>Vérifiez toujours l'heure et la date avant de venir, car notre horaire peut varier. Consultez notre horaire complet ci-dessous.</p>
    <p>Notre horaire typique est :</p>
    <ul>
        <li><strong>14h30 - 15h00 :</strong> Cours d'introduction, recommandé aux nouveaux danseurs</li>
        <li><strong>15h00 - 17h30 :</strong> Contredanse</li>
    </ul>
    <p>ou</p>
    <ul>
        <li><strong>18h30 - 19h00 :</strong> Cours d'introduction, recommandé aux nouveaux danseurs</li>
        <li><strong>19h00 - 21h30 :</strong> Contredanse</li>
    </ul>
{% endif %}

{% if page.lang == "en" %}
    <h3>Location</h3>
    <p>Our dances are usually at Patro Villeray, 7355 Avenue Christophe-Colomb, Montreal.</p>
    <p>Getting there:</p>
    <ul>
        <li><strong>Metro:</strong> The closest metro station is Jean-Talon, on the orange and blue lines, a ten minute walk from the hall.</li>
        <li><strong>Bike:</strong> There are bike lanes on Christophe-Colomb and bike parking in front of the hall. There are BIXI stations nearby as well.</li>
        <li><strong>Car:</strong> Parking is available in the parking lot in front of the building, accessible from Avenue Christophe-Colomb, or the parking lot behind the building, accessible from Rue Everett.</li>
    </ul>
    <p>We dance in different rooms in the building so please note which room we are dancing in and follow the signs within the building to find our room.</p>
{% elsif page.lang == "fr" %}
    <h3>Lieu</h3>
    <p>Nos danses ont habituellement lieu au Patro Villeray, 7355 Avenue Christophe-Colomb, Montréal.</p>
    <p>Comment y arriver :</p>
    <ul>
        <li><strong>Métro :</strong> La station de métro la plus proche est Jean-Talon, sur les lignes orange et bleue, à dix minutes de marche du Patro.</li>
        <li><strong>Vélo :</strong> Il y a des pistes cyclables sur Christophe-Colomb et un parking vélo devant le Patro. Il y a également des stations BIXI à proximité.</li>
        <li><strong>Voiture :</strong> Il y a un stationnement disponible sur le côté de l'immeuble, accessible depuis l'avenue Christophe-Colomb, et un stationnement derrière l'immeuble, accessible depuis la rue Everett.</li>
    </ul>
    <p>On danse dans différentes pièces du bâtiment, alors veuillez noter dans quelle salle on danse et suivre les panneaux à l'intérieur du bâtiment pour notre salle.</p>
{% endif %}

{% if page.lang == "en" %}
    <h3>Cost</h3>
    <p>We have a sliding scale payment system.</p>
    <ul>
        <li>Minimum: $8</li>
        <li>Suggested: $15-20</li>
        <li>Sponsor: $25-30</li>
        <li>Children under 13: no minimum </li>
    </ul>
    <p>We offer this price flexibility to keep our dances accessible while also being able to pay our talented musicians and callers. Cash is preferred, but we also accept Interac e-Transfer and PayPal.</p>
{% elsif page.lang == "fr" %}
    <h3>Coût</h3>
    <p>Nous disposons d'un système de paiement à échelle mobile.</p>
    <ul>
        <li>Minimum : 8 $</li>
        <li>Suggéré : 15 - 20 $</li>
        <li>Parrain : 25 - 30 $</li>
        <li>Enfants de moins de 13 ans : pas de minimum</li>
    </ul>
    <p>Nous offrons cette flexibilité tarifaire pour garder nos danses accessibles tout en étant en mesure de rémunérer nos talentueux musiciens et calleur(e)s. L'argent comptant est préférable, mais nous acceptons également les virements électroniques Interac et PayPal.</p>
{% endif %}

{% if page.lang == "en" %}
    <h3>Safety</h3>
    <p>To keep all of our dancers and our community safe, please stay home if you have cold or flu-like symptoms, even if they are minor. Masks are optional at all of our dances.</p>
{% elsif page.lang == "fr" %}
    <h3>Santé</h3>
    <p>Pour assurer la sécurité de tous nos danseurs et de notre communauté, veuillez rester à la maison si vous présentez des symptômes de rhume ou de grippe, même s'ils sont mineurs. Les masques sont facultatifs à toutes nos danses.</p>
{% endif %}

{% if page.lang == "en" %}
    <h3 id='contact'>Contact</h3>
    <ul>
        <li><a href="/en/mailing-list">Subscribe to our mailing list</a> to find out about upcoming dances and other news.</li>
        <li>Follow us on Instagram <a href="https://www.instagram.com/contramontreal/">@contramontreal</a></li>
        <li>Follow us on Facebook <a href="https://www.facebook.com/contramontreal">@contramontreal</a></li>
        <li>Join our Facebook group <a href="https://www.facebook.com/groups/223410984511785/">Montreal Contra Dances</a></li>
        <li>Email us at <a href="mailto:info@contramontreal.org">info@contramontreal.org</a></li>
    </ul>
{% elsif page.lang == "fr" %}
    <h3 id='coordonnées'>Coordonnées</h3>
    <ul>
        <li><a href="/fr/liste-de-diffusion">Abonnez-vous à notre liste de diffusion</a> pour être informé des danses à venir et d'autres actualités.</li>
        <li>Suivez-nous sur Instagram <a href="https://www.instagram.com/contramontreal/">@contramontreal</a></li>
        <li>Suivez-nous sur Facebook <a href="https://www.facebook.com/contramontreal">@contramontreal</a></li>
        <li>Rejoignez notre groupe Facebook <a href="https://www.facebook.com/groups/223410984511785/">Montreal Contra Dances</a></li>
        <li>Envoyez-nous un courriel à <a href="mailto:info@contramontreal.org">info@contramontreal.org</a></li>
    </ul>
{% endif %}

<h2>
{% if page.lang == "en" %}
    Upcoming Dances
{% elsif page.lang == "fr" %}
    Danses à venir
{% endif %}
</h2>

{% if page.lang == "en" %}
<p>Subscribe to our calendar so that every dance appears automatically in your calendar!</p>
<ul>
    <li>
        <a href="https://calendar.google.com/calendar/r?cid=webcal://www.contramontreal.org/en/contramontreal.ics">Direct link for Google Calendar</a>
        <ul>
            <li>Step 1: Open this link from a dekstop browser to add it to your Google Calendar</li>
            <li>Step 2: Enable the calendar from the mobile app to see events on your phone</li>
        </ul>
    </li>
    <li>
        <a href="webcal://www.contramontreal.org/en/contramontreal.ics">Webcal link for other calendar apps</a>
        <ul>
            <li>Steps vary. May be labeled "Subscribe to calendar" or "Add calendar from URL" or similar.</li>
        </ul>
    </li>
</ul>
{% elsif page.lang == "fr" %}
<p>Abonnez-vous à notre calendrier pour que chaque danse s'affiche automatiquement dans votre agenda!</p>
<ul>
    <li>
        <a href="https://calendar.google.com/calendar/r?cid=webcal://www.contramontreal.org/fr/contramontreal.ics">Lien direct pour Google Agenda</a>
        <ul>
            <li>Étape 1: Ouvrez ce lien sur votre ordinateur pour l'ajouter à votre Google Agenda</li>
            <li>Étape 2: Activez le calendrier dans l'application mobile pour voir les événements sur votre téléphone.</li>
        </ul>
    </li>
    <li>
        <a href="webcal://www.contramontreal.org/fr/contramontreal.ics">Lien Webcal pour les autres applications de calendrier</a>
        <ul>
            <li>Les étapes varient. Elles peuvent s'intituler «S'abonner au calendrier», «Ajouter un calendrier avec une URL» ou similaire.</li>
        </ul>
    </li>
</ul>
{% endif %}

{% if page.lang == "en" %}
    <p><a href="/en/past-dances">View our past dances</a></p>
{% elsif page.lang == "fr" %}
    <p><a href="/fr/danses-passées">Voir nos danses passées</a></p>
{% endif %}

{% for dance in site.data.dances %}
{% comment %}
    Dance cards are pruned at run time (to today as of run time) in javascript,
    but we should prune at build time too (to today as of build time) so that
    users without javascript do not have to see the entire list.
{% endcomment %}
{% assign current_date = 'today' | date: '%Y-%m-%d' %}
{% if dance.date and dance.date >= current_date %}
{% include dance_card.html dance = dance %}
{% endif %}
{% endfor %}
